<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>سجلات {{ region }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        body { background: #f8f9fa; padding: 30px; }
        /* باركود صغير في الزاوية */
        #qr-mini { position: fixed; top: 20px; left: 20px; cursor: pointer; background: white; padding: 8px; border-radius: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); text-align: center; }
        #qr-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 2000; align-items: center; justify-content: center; }
        .large-qr-card { background: white; padding: 40px; border-radius: 25px; text-align: center; }
    </style>
</head>
<body>

    <div id="qr-mini" onclick="document.getElementById('qr-overlay').style.display='flex'">
        <div id="small_qr"></div>
        <small>توسيع QR</small>
    </div>

    <div id="qr-overlay" onclick="this.style.display='none'">
        <div class="large-qr-card" onclick="event.stopPropagation()">
            <h4>باركود تسجيل: {{ region }}</h4>
            <div id="large_qr" class="my-4 d-flex justify-content-center"></div>
            <button class="btn btn-dark w-100" onclick="window.print()">طباعة</button>
        </div>
    </div>

    <div class="container">
        <div class="d-flex justify-content-between mb-4">
            <h2>سجل منطقة: {{ region }}</h2>
            <a href="/" class="btn btn-secondary">الرجوع</a>
        </div>

        <table class="table bg-white shadow-sm rounded">
            <thead class="table-dark">
                <tr><th>الاسم</th><th>الرقم العسكري</th><th>السيارة</th><th>الوقت</th></tr>
            </thead>
            <tbody>
                {% for log in logs %}
                <tr>
                    <td>{{ log.username }}</td>
                    <td>{{ log.military_id }}</td>
                    <td>{{ log.car_type }}</td>
                    <td>{{ log.timestamp.strftime('%H:%M - %Y/%m/%d') }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <script>
        new QRCode(document.getElementById("small_qr"), { text: "{{ qr_link }}", width: 50, height: 50 });
        new QRCode(document.getElementById("large_qr"), { text: "{{ qr_link }}", width: 250, height: 250 });
    </script>
</body>
</html>